## DCAN：Deep Contour-Aware Networks for Accurate Gland Segmentation

### Abstract

​	病理学家经常使用腺体的形态学来评估腺癌的恶性程度。准确的从组织学图像中分割腺体是获得可靠的形态学数据进行定量诊断的关键步骤。本文提出一个有效的深度轮廓-感知网络（DCAN），在一个统一的多任务学习框架下来解决该挑战。在提出的网络中，利用了多层结构的多层次上下文特征以及辅助监督来准确分割。当训练时包含多任务归一化后，中间层特征的辨别能力可以进一步提高。而且，我们的网络不仅可以输出准确的概率图，同时可以描绘清晰的边界，以分开聚集的目标，进一步提升分割性能。该统一的框架可以有效的应用于大型的组织病理数据，而不需要单独生成轮廓来后处理。我们的方法赢得了2015MICCAI Gland Segmentation Challenge。

![f1](images\f1.png)

### Introduction

​	通常，一个典型的腺体由一个腔区组成，腔区形成内部管状结构，上皮细胞核包围着细胞质，如图1所示。由腺上皮细胞引起的恶性肿瘤，也称为腺癌，是最常见的癌症形式。在常规的组织病理学检查中，腺体形态学被广泛用于评估乳腺、前列腺、结肠等多种腺癌的恶性程度。准确的腺体分割是获得形态学统计数据以显示肿瘤侵袭性的重要前提。通常是由病理学专家来评估活检样本中的腺体结构。但是，手工标注具有有限的再现性，费时费力。随着whole slide成像的出现，大量的组织病理学数据需要分析。因此，在临床实践中继续自动分割方法来提高效率以及可靠性，并减轻专家负担。

​	然而，该任务具有挑战性。第一，根据不同的组织学分级和不同的疾病，腺体的形态有很大变化。图1（左列）显示了结肠组织良恶性病例腺体结构的巨大差异。第二，在组织样本中存在接触的腺体，使得自动分离物体的方法非常困难。第三，在中、低分化腺癌等恶性肿瘤中，腺体结构严重退化，如图1（坐下）。因此，利用腺体规律性先验知识的方法在这种情况下很容失败。此外，切片、染色等组织制备过程的变化会导致组织变形、伪影和组织外观不一致，也会阻碍分割。

​	在过去的很多年里，许多研究致力于解决该问题。但是，算法和专家之间的结果还是有距离。之前的研究可以分为两类：1）基于像素的方法。利用手工特征：纹理，颜色，形态学线索以及Haar-like特征来检测腺体结构；2）基于结构的方法。这类方法大多利用腺体结构的先验知识，如基于图的方法，利用测地线距离变换绘制腺体边界，极坐标空间随机场模型，随机多变性模型等。尽管这些方法在腺瘤和高分化腺癌的病例中取得了不错的结果，在腺结构严重畸形的恶性肿瘤中，它们可能无法达到令人满意的表现。近期，深度学习的方法驱动了计算机视觉和医疗图像计算的发展。与我们工作最相关的是U-net。

​	本文提出一个新的深度轮廓-感知网络来解决该问题。我们的方法解决腺体分割的三个关键问题：1）我们的方法利用多层上下文特征表示。利用FCN网络，输入图像直接输出概率图。2）我们的方法没有对腺体结构做假设，可以很容易推广到不同组织病理学分级的活检样本，包括良性和恶性病理。3）我们的方法在多任务学习框架下，研究从租的信息：腺体和轮廓。因此可以同时分割腺体和分离聚集的物体，特别是在良性存在接触腺体的情况下。

### Method

​	我们提出利用多层上下文特征以及辅助监督来生成好的概率图。然后通过融合物体和轮廓信息来有效分割。为了减轻训练数据不足的问题，我们利用了迁移学习方法来提高性能。

#### FCN with multi-level contextual features

![f2](images\f2.png)

​	利用不同层级上下文信息：即不同感受野下的intensities。如图2所示。特别的，网络结构包含一些巻积层，5个max-pooling层和3个反卷积层。随着网络加深，感知野变大。因此，上采样层被设计考虑了不同感知野大小。他们上采样特征图并给予给定感知野的上下文信息来做出预测。然后将预测结果通过sum操作进行融合生成最后的分割结果（基于多层上下文特征和softmax）。

​	受到前面研究的启发，加权辅助分类C1-C3加入到了网络以增强训练过程。这可以减轻梯度消失问题，辅助监督可以增强回传梯度流。最后使用整体损失$\ \mathcal{L}\ $来训练FCN：即辅助损失$\ \mathcal{L}_a(I;W)\ $和对应的权重$\ w_a\ $，数据损失$\ \mathcal{L}_e(I;W)\ $的组合
$$
\mathcal{L}(I;W) = \lambda\psi(W)+\sum_aw_a\mathcal{L}_a(I;W)+\mathcal{L}_e(I;W)
$$
其中W表示网络参数，$\ \psi(W)\ $是正则化项。

#### Deep contour-aware network

![f3](images\f3.png)

​	进利用腺体物体的概率很难分离接触的腺体。这是由于downsampling导致的空间信息损失。上皮细胞核形成的边界信息为分割腺体提供了良好的补充线索。因此，我们提出一个deep contour-aware network来分割腺体并分离聚集的物体。

​	如图3所示。我们将腺体分割任务作为多任务学习。特别的，特征图使用两个分支上采样，分别输出分割mask或contours mask。每个分支，mask有FCN和多层上下文特征预测。downsampling权值共享。两个分支上采样层参数独立训练。因此，特征表示可以编码分割和轮廓信息。联合多任务学习有几个好处：1）通过对精细相关任务进行多重正则化，提高了中间特征的判别能力，提高了分割的鲁棒性。2）多任务学习提高了物体层次的分割能力，特别是在良性组织学图像中经常存在接触的物体。

​	训练过程中，辅助分类器的权值$\ w_a\ $逐渐较小到边界值，在最后的loss中舍弃了这些项。最后是一个逐像素分类问题，包括objects和contours：
$$
\mathcal{L}_{total}(x;\theta) = \lambda\psi(\theta)-\sum_{x\in\mathcal{X}}\log p_o(x,\ell_o(x);W_o,W_s)-\sum_{x\in\mathcal{X}}\log p_c(x,\ell_c(x);W_c,W_s)
$$
第一项是$\ L_2\ $正则化。$\ x\ $是像素位置，$\ \ell_o(x)\ $是标注。

​	$\ p_o\ $和$\ p_c\ $向融合生成最终结果：
$$
m(x) = 
\begin{cases}
1 & \text{if}\ \ p_o(x;W_o,W_s)\ge t_o\ \ \text{and}\ \ p_c(x;Wc,W_s)<t_c\\
0 & \text{otherwise}
\end{cases}
$$
接着后处理包括使用disk filter平滑，填充holes以及移除小区域。最后每个连接组件都被标记为一个单独值。

#### Transfer learning with rich feature hierarchies

卷积核在低层是通用的，高层则具体到不同任务。因此迁移学习可以减轻过拟合，提升性能。我们使用了现有的模型DeepLab。我们使用预训练权值初始化了downsampling层，其他随机初始化。

![t1](images\t1.png)

![t2](images\t2.png)

