## A Deep Model with Shape-Preserving Loss for Gland Instance Segmentation

> MICCAI 2018

### ABSTRACT

​	分割腺体需要分离腺体与背景，还要通过边界检测识别每个单独的腺体。挑战有背景杂乱，邻近腺体之间的间隙太小，黏连。State-of-the-art方法采用多通道/多任务的方式，来分割以及边界检测，模型复杂度太高，训练困难。我们提出一个新的shape-preserving loss，可以同时帮助分割和边界检测。

### INTROFUCTION

​	腺体实例分割包含两个子任务：1）腺体分割（分离腺体和背景）；2）边界检测（分离腺体个体）。挑战：1. 腺体外观变化很大；2. 腺体之间黏连。Xu等提出多通道深度网络，分别提取腺体区域，边界和位置信息。最后融合多通道结果。Chen等将该问题作为多任务学习问题，网络两个分支，一个使用分割标注，一个使用边界标注。

![f1](images1\f1.png)

### METHOD

​	学习一个统一的模型，同时分割腺体和检测边界，直接的方法就是最小化逐像素交叉熵损失**。但是通过逐像素交叉熵损失学习边界检测器只利用了单像素的信息，没有考虑全局形状信息。此外，由于腺体边界的不确定性，准确定位腺体边界像素很困难**。

#### 2.1 Shape-Preserving Loss

​	我们提出的shape-preserving loss包含两部分：1）形状相似度损失，可以检测出具有相似几何形状的边界；2）加权逐像素交叉熵损失，用于接近或黏连的腺体分割。

![f2](images1\f2.png)

**Shape Similarity Loss.** 给定一个标注，我们首先生成边界图并将整个边界图分为多个边界段（默认长度在[16,24]像素内），如图2（b）。对于每个边界段$\ l_i\ $（如图2 c），采用3像素搜索范围以找到对应的边界段$\ s_i\ $。3像素的搜索范围限定了$\ l_i\ $和$\ s_i\ $的变化范围，度量的限制性没有那么高，相比于逐像素交叉熵更有效。接着，基于曲线拟合方法（curve fitting）方法来度量形状相似度。给定$\ l_i\ $以及$\ s_i\ $，我们采用曲线（三次函数）拟合方法以获得它们的近似曲线函数$\ f(l_i) = a_1x^3+b_1x^2+c_1x+d_1\ $,$\ f(s_i) = a_2x^3+b_2x^2+c_2x+d_2\ $。$\ l_i\ $和$\ s_i\ $之间的相似度定义为
$$
ss_i = \left |\frac{<F_1,F_2>}{|F_1||F_2|}\right | \in [0,1]
$$
其中$\ F_1 = [a_1,b_1,c_1]\ $,$\ F_2 = [a_2,b_2,c_2]\ $，$<>$为点乘操作，$\parallel$计算向量的长度。如果$\ |s_i|\ <0.9\cdot|l_i| $或$\ |s_i|>1.2\cdot|l_i|\ $,则手动设置形状相似度$\ ss_i\ $为0。基于形状相似度度量，形状相似度损失$\ L_s=w_s\cdot(1-ss)\ $,其中$\ w_s\ $设置为4以提高形状相似度损失在整个损失的重要性。

**Weighted Pixel-Wise Cross-Entropy Loss.**为了更好的辨别接近或黏连的腺体实例，且受到U-Net模型权重矩阵的启发，我们构建另一个权重矩阵$\ W\ $，有效的提升贴近腺体实例间的背景的重要性。对于每个背景像素$\ i\ $，权重$\ w(i)\ $定义为
$$
w(i)=1+w_0\cdot\frac{1}{1+e^{d_1(i)+d_2(i)-\mu}}
$$
其中$\ d_1\ $表示距离最近腺体的距离，$\ d_2\ $表示距离第二近的腺体的距离。在我们的实验中，设置$\ w_0=6\ $，$\ \mu=15\ $像素。因此，shape-preserving 损失L可以表示为
$$
L = W\cdot L_p\cdot(1+L_s)
$$
其中$\ L_p\ $为全部的逐像素交叉熵损失。

#### 2.2 Deep Convolutional Neural Network

模型前面的边路输出用以学习准确的边界检测，后面的边路输出学习腺体分割。由于shape-preserving loss均衡了边界检测和像素分割的重要性，训练过程是可控的，并能快速收敛。

![f3](images1\f3.png)

### EVALUATION and DISCUSSION

![t1](images1\t1.png)![f4](images1\f4.png)

![f5](images1\f5.png)

![f6](images1\f6.png)

### 

